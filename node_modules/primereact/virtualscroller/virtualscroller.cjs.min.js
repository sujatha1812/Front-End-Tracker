"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("primereact/hooks"),r=require("primereact/utils");function n(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var o=n(e);function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},l.apply(this,arguments)}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e){if(Array.isArray(e))return e}function a(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,l=[],s=!0,i=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(l.push(n.value),!t||l.length!==t);s=!0);}catch(e){i=!0,o=e}finally{try{s||null==r.return||r.return()}finally{if(i)throw o}}return l}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function u(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}function f(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function m(e,t){return i(e)||a(e,t)||u(e,t)||f()}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var g=o.memo(o.forwardRef((function(e,n){var s="vertical"===e.orientation,i="horizontal"===e.orientation,a="both"===e.orientation,c=m(o.useState(a?{rows:0,cols:0}:0),2),u=c[0],f=c[1],d=m(o.useState(a?{rows:0,cols:0}:0),2),h=d[0],v=d[1],w=m(o.useState(a?{rows:0,cols:0}:0),2),y=w[0],b=w[1],S=m(o.useState(e.numToleratedItems),2),O=S[0],j=S[1],I=m(o.useState(e.loading),2),T=I[0],x=I[1],z=m(o.useState([]),2),E=z[0],L=z[1],R=o.useRef(null),P=o.useRef(null),M=o.useRef(null),N=o.useRef(null),U=o.useRef(a?{top:0,left:0}:0),D=o.useRef(null),A=t.usePrevious(e.items),C=t.usePrevious(e.loading),H=function(e){R.current&&R.current.scrollTo(e)},k=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"auto",n=W(),o=n.numToleratedItems,l=e.itemSize,s=X(),c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return e<=t?0:e},m=function(e,t,r){return e*t+r},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return H({left:e,top:t,behavior:r})};if(a){var p={rows:c(t[0],o[0]),cols:c(t[1],o[1])};p.rows===u.rows&&p.cols===u.cols||(d(m(p.cols,l[1],s.left),m(p.rows,l[0],s.top)),f(p))}else{var g=c(t,o);g!==u&&(i?d(m(g,l,s.left),0):d(0,m(g,l,s.top)),f(g))}},V=function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"auto";if(r){var o=_(),l=o.first,s=o.viewport,c=e.itemSize,u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return H({left:e,top:t,behavior:n})},f="to-start"===r,m="to-end"===r;if(f){if(a)s.first.rows-l.rows>t[0]?u(s.first.cols*c,(s.first.rows-1)*c):s.first.cols-l.cols>t[1]&&u((s.first.cols-1)*c,s.first.rows*c);else if(s.first-l>t){var d=(s.first-1)*c;i?u(d,0):u(0,d)}}else if(m)if(a)s.last.rows-l.rows<=t[0]+1?u(s.first.cols*c,(s.first.rows+1)*c):s.last.cols-l.cols<=t[1]+1&&u((s.first.cols+1)*c,s.first.rows*c);else if(s.last-l<=t+1){var p=(s.first+1)*c;i?u(p,0):u(0,p)}}else k(t,n)},_=function(){var t=e.itemSize,r=function(e,t){return Math.floor(e/(t||e))},n=u,o=0;if(R.current){var l=R.current.scrollTop,s=R.current.scrollLeft;if(a)o={rows:(n={rows:r(l,t[0]),cols:r(s,t[1])}).rows+y.rows,cols:n.cols+y.cols};else o=(n=r(i?s:l,t))+y}return{first:u,last:h,viewport:{first:n,last:o}}},W=function(){var t=e.itemSize,r=X(),n=R.current?R.current.offsetWidth-r.left:0,o=R.current?R.current.offsetHeight-r.top:0,l=function(e,t){return Math.ceil(e/(t||e))},s=function(e){return Math.ceil(e/2)},c=a?{rows:l(o,t[0]),cols:l(n,t[1])}:l(i?n:o,t);return{numItemsInViewport:c,numToleratedItems:O||(a?[s(c.rows),s(c.cols)]:s(c))}},J=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1?arguments[1]:void 0;return e.items?Math.min(r?(e.columns||e.items[0]).length:e.items.length,t):0},X=function(){if(P.current){var e=getComputedStyle(P.current),t=parseInt(e.paddingLeft,10)+Math.max(parseInt(e.left,10),0),r=parseInt(e.paddingRight,10)+Math.max(parseInt(e.right,10),0),n=parseInt(e.paddingTop,10)+Math.max(parseInt(e.top,10),0),o=parseInt(e.paddingBottom,10)+Math.max(parseInt(e.bottom,10),0);return{left:t,right:r,top:n,bottom:o,x:t+r,y:n+o}}return{left:0,right:0,top:0,bottom:0,x:0,y:0}},q=function(){if(R.current){var t=R.current.parentElement,r=e.scrollWidth||"".concat(R.current.offsetWidth||t.offsetWidth,"px"),n=e.scrollHeight||"".concat(R.current.offsetHeight||t.offsetHeight,"px"),o=function(e,t){return R.current.style[e]=t};a||i?(o("height",n),o("width",r)):o("height",n)}},F=function(){var t=e.items;if(M.current&&t){var r=e.itemSize,n=X(),o=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return M.current.style[e]=(t||[]).length*r+n+"px"};a?(o("height",t,r[0],n.y),o("width",e.columns||t[1],r[1],n.x)):i?o("width",e.columns||t,r,n.x):o("height",t,r,n.y)}},B=function(t){if(P.current){var r=t?t.first:u,n=e.itemSize,o=function(e,t){return e*t},l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;N.current&&(N.current.style.top="-".concat(t,"px")),P.current.style.transform="translate3d(".concat(e,"px, ").concat(t,"px, 0)")};if(a)l(o(r.cols,n[1]),o(r.rows,n[0]));else{var s=o(r,n);i?l(s,0):l(0,s)}}},K=function(t){var r=t.target,n=e.itemSize,o=X(),l=function(e,t){return e?e>t?e-t:e:0},s=function(e,t){return Math.floor(e/(t||e))},c=function(e,t,r,n,o,l){return e<=o?o:l?r-n-o:t+o-1},f=function(e,t,r,n,o,l,s){return e<=l?0:Math.max(0,s?e<t?r:e-l:e>t?r:e-2*l)},m=function(e,t,r,n,o,l){var s=t+n+2*o;return e>=o&&(s+=o+1),J(s,l)},d=l(r.scrollTop,o.top),p=l(r.scrollLeft,o.left),g=0,v=h,w=!1;if(a){var b=U.current.top<=d,S=U.current.left<=p,j={rows:s(d,n[0]),cols:s(p,n[1])},I={rows:c(j.rows,u.rows,h.rows,y.rows,O[0],b),cols:c(j.cols,u.cols,h.cols,y.cols,O[1],S)};g={rows:f(j.rows,I.rows,u.rows,0,0,O[0],b),cols:f(j.cols,I.cols,u.cols,0,0,O[1],S)},v={rows:m(j.rows,g.rows,0,y.rows,O[0]),cols:m(j.cols,g.cols,0,y.cols,O[1],!0)},w=g.rows!==u.rows&&v.rows!==h.rows||g.cols!==u.cols&&v.cols!==h.cols,U.current={top:d,left:p}}else{var T=i?p:d,x=U.current<=T,z=s(T,n);v=m(z,g=f(z,c(z,u,h,y,O,x),u,0,0,O,x),0,y,O),w=g!==u&&v!==h,U.current=T}return{first:g,last:v,isRangeChanged:w}},Y=function(t){var r=K(t),n=r.first,o=r.last;if(r.isRangeChanged){var l={first:n,last:o};B(l),f(n),v(o),e.onScrollIndexChange&&e.onScrollIndexChange(l),e.lazy&&e.onLazyLoad&&e.onLazyLoad(l)}},$=function(t){var r=(e.items||[]).length,n=a?u.rows+t:u+t;return{index:n,count:r,first:0===n,last:n===r-1,even:n%2==0,odd:n%2!=0,props:e}},G=function(t,r){var n=E.length;return p({index:t,count:n,first:0===t,last:t===n-1,even:t%2==0,odd:t%2!=0,props:e},r)},Q=function(){var t=e.items;return t&&!T?a?t.slice(u.rows,h.rows).map((function(t){return e.columns?t:t.slice(u.cols,h.cols)})):i&&e.columns?t:t.slice(u,h):[]},Z=function(){var t,r,n,o,l;q(),t=W(),r=t.numItemsInViewport,n=t.numToleratedItems,o=function(e,t,r,n){return J(e+t+(e<r?2:3)*r,n)},l=a?{rows:o(u.rows,r.rows,n[0]),cols:o(u.cols,r.cols,n[1],!0)}:o(u,r,n),b(r),j(n),v(l),e.showLoader&&L(a?Array.from({length:r.rows}).map((function(){return Array.from({length:r.cols})})):Array.from({length:r})),e.lazy&&e.onLazyLoad&&e.onLazyLoad({first:u,last:l}),F()};t.useMountEffect((function(){Z()})),t.useUpdateEffect((function(){Z()}),[e.itemSize,e.scrollHeight]),t.useUpdateEffect((function(){A&&A.length===(e.items||[]).length||Z(),e.lazy&&C!==e.loading&&e.loading!==T&&x(e.loading)})),t.useUpdateEffect((function(){U.current=a?{top:0,left:0}:0}),[e.orientation]),o.useImperativeHandle(n,(function(){return{scrollTo:H,scrollToIndex:k,scrollInView:V,getRenderedRange:_}}));var ee=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=G(t,n),s=r.ObjectUtils.getJSXElement(e.loadingTemplate,l);return o.createElement(o.Fragment,{key:t},s)},te=function(t,n){var l=$(n),s=r.ObjectUtils.getJSXElement(e.itemTemplate,t,l);return o.createElement(o.Fragment,{key:l.index},s)};if(e.disabled){var re=r.ObjectUtils.getJSXElement(e.contentTemplate,{items:e.items,rows:e.items,columns:e.columns});return o.createElement(o.Fragment,null,e.children,re)}var ne=r.ObjectUtils.findDiffKeys(e,g.defaultProps),oe=r.classNames("p-virtualscroller",{"p-both-scroll":a,"p-horizontal-scroll":i},e.className),le=function(){if(!e.loaderDisabled&&e.showLoader&&T){var t=r.classNames("p-virtualscroller-loader",{"p-component-overlay":!e.loadingTemplate}),n=o.createElement("i",{className:"p-virtualscroller-loading-icon pi pi-spinner pi-spin"});return e.loadingTemplate&&(n=E.map((function(e,t){return ee(t,a&&{numCols:y.cols})}))),o.createElement("div",{className:t},n)}return null}(),se=function(){var t=Q().map(te),n=r.classNames("p-virtualscroller-content",{"p-virtualscroller-loading":T}),l=o.createElement("div",{ref:P,className:n},t);if(e.contentTemplate){var c={className:n,contentRef:function(e){return P.current=r.ObjectUtils.getRefElement(e)},spacerRef:function(e){return M.current=r.ObjectUtils.getRefElement(e)},stickyRef:function(e){return N.current=r.ObjectUtils.getRefElement(e)},items:Q,getItemOptions:function(e){return $(e)},children:t,element:l,props:e,loading:T,getLoaderOptions:function(e,t){return G(e,t)},loadingTemplate:e.loadingTemplate,itemSize:e.itemSize,rows:T?e.loaderDisabled?E:[]:Q(),columns:e.columns&&(a||i)?T&&e.loaderDisabled?a?E[0]:E:e.columns.slice(a?u.cols:u,a?h.cols:h):e.columns,vertical:s,horizontal:i,both:a};return r.ObjectUtils.getJSXElement(e.contentTemplate,c)}return l}(),ie=e.showSpacer?o.createElement("div",{ref:M,className:"p-virtualscroller-spacer"}):null;return o.createElement("div",l({ref:R,className:oe,tabIndex:0,style:e.style},ne,{onScroll:function(t){e.onScroll&&e.onScroll(t),e.delay?(D.current&&clearTimeout(D.current),!T&&e.showLoader&&K(t).isRangeChanged&&x(!0),D.current=setTimeout((function(){Y(t),T&&e.showLoader&&!e.lazy&&x(!1)}),e.delay)):Y(t)}}),se,ie,le)})));g.displayName="VirtualScroller",g.defaultProps={__TYPE:"VirtualScroller",id:null,style:null,className:null,items:null,itemSize:0,scrollHeight:null,scrollWidth:null,orientation:"vertical",numToleratedItems:null,delay:0,lazy:!1,disabled:!1,loaderDisabled:!1,columns:null,loading:!1,showSpacer:!0,showLoader:!1,loadingTemplate:null,itemTemplate:null,contentTemplate:null,onScroll:null,onScrollIndexChange:null,onLazyLoad:null},exports.VirtualScroller=g;
