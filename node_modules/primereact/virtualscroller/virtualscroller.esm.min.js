import*as t from"react";import{usePrevious as e,useMountEffect as r,useUpdateEffect as n}from"primereact/hooks";import{ObjectUtils as o,classNames as l}from"primereact/utils";function i(){return i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},i.apply(this,arguments)}function s(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function a(t){if(Array.isArray(t))return t}function c(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,l=[],i=!0,s=!1;try{for(r=r.call(t);!(i=(n=r.next()).done)&&(l.push(n.value),!e||l.length!==e);i=!0);}catch(t){s=!0,o=t}finally{try{i||null==r.return||r.return()}finally{if(s)throw o}}return l}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function f(t,e){if(t){if("string"==typeof t)return u(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(t,e):void 0}}function m(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function p(t,e){return a(t)||c(t,e)||f(t,e)||m()}function d(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function h(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?d(Object(r),!0).forEach((function(e){s(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var g=t.memo(t.forwardRef((function(s,a){var c="vertical"===s.orientation,u="horizontal"===s.orientation,f="both"===s.orientation,m=p(t.useState(f?{rows:0,cols:0}:0),2),d=m[0],v=m[1],w=p(t.useState(f?{rows:0,cols:0}:0),2),y=w[0],b=w[1],S=p(t.useState(f?{rows:0,cols:0}:0),2),I=S[0],T=S[1],x=p(t.useState(s.numToleratedItems),2),O=x[0],z=x[1],E=p(t.useState(s.loading),2),L=E[0],R=E[1],j=p(t.useState([]),2),P=j[0],M=j[1],A=t.useRef(null),C=t.useRef(null),D=t.useRef(null),N=t.useRef(null),H=t.useRef(f?{top:0,left:0}:0),k=t.useRef(null),V=e(s.items),W=e(s.loading),J=function(t){A.current&&A.current.scrollTo(t)},X=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"auto",r=B(),n=r.numToleratedItems,o=s.itemSize,l=U(),i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0;return t<=e?0:t},a=function(t,e,r){return t*e+r},c=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return J({left:t,top:r,behavior:e})};if(f){var m={rows:i(t[0],n[0]),cols:i(t[1],n[1])};m.rows===d.rows&&m.cols===d.cols||(c(a(m.cols,o[1],l.left),a(m.rows,o[0],l.top)),v(m))}else{var p=i(t,n);p!==d&&(u?c(a(p,o,l.left),0):c(0,a(p,o,l.top)),v(p))}},F=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"auto";if(e){var n=_(),o=n.first,l=n.viewport,i=s.itemSize,a=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return J({left:t,top:e,behavior:r})},c="to-start"===e,m="to-end"===e;if(c){if(f)l.first.rows-o.rows>t[0]?a(l.first.cols*i,(l.first.rows-1)*i):l.first.cols-o.cols>t[1]&&a((l.first.cols-1)*i,l.first.rows*i);else if(l.first-o>t){var p=(l.first-1)*i;u?a(p,0):a(0,p)}}else if(m)if(f)l.last.rows-o.rows<=t[0]+1?a(l.first.cols*i,(l.first.rows+1)*i):l.last.cols-o.cols<=t[1]+1&&a((l.first.cols+1)*i,l.first.rows*i);else if(l.last-o<=t+1){var d=(l.first+1)*i;u?a(d,0):a(0,d)}}else X(t,r)},_=function(){var t=s.itemSize,e=function(t,e){return Math.floor(t/(e||t))},r=d,n=0;if(A.current){var o=A.current.scrollTop,l=A.current.scrollLeft;if(f)n={rows:(r={rows:e(o,t[0]),cols:e(l,t[1])}).rows+I.rows,cols:r.cols+I.cols};else n=(r=e(u?l:o,t))+I}return{first:d,last:y,viewport:{first:r,last:n}}},B=function(){var t=s.itemSize,e=U(),r=A.current?A.current.offsetWidth-e.left:0,n=A.current?A.current.offsetHeight-e.top:0,o=function(t,e){return Math.ceil(t/(e||t))},l=function(t){return Math.ceil(t/2)},i=f?{rows:o(n,t[0]),cols:o(r,t[1])}:o(u?r:n,t);return{numItemsInViewport:i,numToleratedItems:O||(f?[l(i.rows),l(i.cols)]:l(i))}},K=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0;return s.items?Math.min(e?(s.columns||s.items[0]).length:s.items.length,t):0},U=function(){if(C.current){var t=getComputedStyle(C.current),e=parseInt(t.paddingLeft,10)+Math.max(parseInt(t.left,10),0),r=parseInt(t.paddingRight,10)+Math.max(parseInt(t.right,10),0),n=parseInt(t.paddingTop,10)+Math.max(parseInt(t.top,10),0),o=parseInt(t.paddingBottom,10)+Math.max(parseInt(t.bottom,10),0);return{left:e,right:r,top:n,bottom:o,x:e+r,y:n+o}}return{left:0,right:0,top:0,bottom:0,x:0,y:0}},Y=function(){if(A.current){var t=A.current.parentElement,e=s.scrollWidth||"".concat(A.current.offsetWidth||t.offsetWidth,"px"),r=s.scrollHeight||"".concat(A.current.offsetHeight||t.offsetHeight,"px"),n=function(t,e){return A.current.style[t]=e};f||u?(n("height",r),n("width",e)):n("height",r)}},$=function(){var t=s.items;if(D.current&&t){var e=s.itemSize,r=U(),n=function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return D.current.style[t]=(e||[]).length*r+n+"px"};f?(n("height",t,e[0],r.y),n("width",s.columns||t[1],e[1],r.x)):u?n("width",s.columns||t,e,r.x):n("height",t,e,r.y)}},q=function(t){if(C.current){var e=t?t.first:d,r=s.itemSize,n=function(t,e){return t*e},o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;N.current&&(N.current.style.top="-".concat(e,"px")),C.current.style.transform="translate3d(".concat(t,"px, ").concat(e,"px, 0)")};if(f)o(n(e.cols,r[1]),n(e.rows,r[0]));else{var l=n(e,r);u?o(l,0):o(0,l)}}},G=function(t){var e=t.target,r=s.itemSize,n=U(),o=function(t,e){return t?t>e?t-e:t:0},l=function(t,e){return Math.floor(t/(e||t))},i=function(t,e,r,n,o,l){return t<=o?o:l?r-n-o:e+o-1},a=function(t,e,r,n,o,l,i){return t<=l?0:Math.max(0,i?t<e?r:t-l:t>e?r:t-2*l)},c=function(t,e,r,n,o,l){var i=e+n+2*o;return t>=o&&(i+=o+1),K(i,l)},m=o(e.scrollTop,n.top),p=o(e.scrollLeft,n.left),h=0,g=y,v=!1;if(f){var w=H.current.top<=m,b=H.current.left<=p,S={rows:l(m,r[0]),cols:l(p,r[1])},T={rows:i(S.rows,d.rows,y.rows,I.rows,O[0],w),cols:i(S.cols,d.cols,y.cols,I.cols,O[1],b)};h={rows:a(S.rows,T.rows,d.rows,0,0,O[0],w),cols:a(S.cols,T.cols,d.cols,0,0,O[1],b)},g={rows:c(S.rows,h.rows,0,I.rows,O[0]),cols:c(S.cols,h.cols,0,I.cols,O[1],!0)},v=h.rows!==d.rows&&g.rows!==y.rows||h.cols!==d.cols&&g.cols!==y.cols,H.current={top:m,left:p}}else{var x=u?p:m,z=H.current<=x,E=l(x,r);g=c(E,h=a(E,i(E,d,y,I,O,z),d,0,0,O,z),0,I,O),v=h!==d&&g!==y,H.current=x}return{first:h,last:g,isRangeChanged:v}},Q=function(t){var e=G(t),r=e.first,n=e.last;if(e.isRangeChanged){var o={first:r,last:n};q(o),v(r),b(n),s.onScrollIndexChange&&s.onScrollIndexChange(o),s.lazy&&s.onLazyLoad&&s.onLazyLoad(o)}},Z=function(t){var e=(s.items||[]).length,r=f?d.rows+t:d+t;return{index:r,count:e,first:0===r,last:r===e-1,even:r%2==0,odd:r%2!=0,props:s}},tt=function(t,e){var r=P.length;return h({index:t,count:r,first:0===t,last:t===r-1,even:t%2==0,odd:t%2!=0,props:s},e)},et=function(){var t=s.items;return t&&!L?f?t.slice(d.rows,y.rows).map((function(t){return s.columns?t:t.slice(d.cols,y.cols)})):u&&s.columns?t:t.slice(d,y):[]},rt=function(){var t,e,r,n,o;Y(),t=B(),e=t.numItemsInViewport,r=t.numToleratedItems,n=function(t,e,r,n){return K(t+e+(t<r?2:3)*r,n)},o=f?{rows:n(d.rows,e.rows,r[0]),cols:n(d.cols,e.cols,r[1],!0)}:n(d,e,r),T(e),z(r),b(o),s.showLoader&&M(f?Array.from({length:e.rows}).map((function(){return Array.from({length:e.cols})})):Array.from({length:e})),s.lazy&&s.onLazyLoad&&s.onLazyLoad({first:d,last:o}),$()};r((function(){rt()})),n((function(){rt()}),[s.itemSize,s.scrollHeight]),n((function(){V&&V.length===(s.items||[]).length||rt(),s.lazy&&W!==s.loading&&s.loading!==L&&R(s.loading)})),n((function(){H.current=f?{top:0,left:0}:0}),[s.orientation]),t.useImperativeHandle(a,(function(){return{scrollTo:J,scrollToIndex:X,scrollInView:F,getRenderedRange:_}}));var nt=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=tt(e,r),l=o.getJSXElement(s.loadingTemplate,n);return t.createElement(t.Fragment,{key:e},l)},ot=function(e,r){var n=Z(r),l=o.getJSXElement(s.itemTemplate,e,n);return t.createElement(t.Fragment,{key:n.index},l)};if(s.disabled){var lt=o.getJSXElement(s.contentTemplate,{items:s.items,rows:s.items,columns:s.columns});return t.createElement(t.Fragment,null,s.children,lt)}var it=o.findDiffKeys(s,g.defaultProps),st=l("p-virtualscroller",{"p-both-scroll":f,"p-horizontal-scroll":u},s.className),at=function(){if(!s.loaderDisabled&&s.showLoader&&L){var e=l("p-virtualscroller-loader",{"p-component-overlay":!s.loadingTemplate}),r=t.createElement("i",{className:"p-virtualscroller-loading-icon pi pi-spinner pi-spin"});return s.loadingTemplate&&(r=P.map((function(t,e){return nt(e,f&&{numCols:I.cols})}))),t.createElement("div",{className:e},r)}return null}(),ct=function(){var e=et().map(ot),r=l("p-virtualscroller-content",{"p-virtualscroller-loading":L}),n=t.createElement("div",{ref:C,className:r},e);if(s.contentTemplate){var i={className:r,contentRef:function(t){return C.current=o.getRefElement(t)},spacerRef:function(t){return D.current=o.getRefElement(t)},stickyRef:function(t){return N.current=o.getRefElement(t)},items:et,getItemOptions:function(t){return Z(t)},children:e,element:n,props:s,loading:L,getLoaderOptions:function(t,e){return tt(t,e)},loadingTemplate:s.loadingTemplate,itemSize:s.itemSize,rows:L?s.loaderDisabled?P:[]:et(),columns:s.columns&&(f||u)?L&&s.loaderDisabled?f?P[0]:P:s.columns.slice(f?d.cols:d,f?y.cols:y):s.columns,vertical:c,horizontal:u,both:f};return o.getJSXElement(s.contentTemplate,i)}return n}(),ut=s.showSpacer?t.createElement("div",{ref:D,className:"p-virtualscroller-spacer"}):null;return t.createElement("div",i({ref:A,className:st,tabIndex:0,style:s.style},it,{onScroll:function(t){s.onScroll&&s.onScroll(t),s.delay?(k.current&&clearTimeout(k.current),!L&&s.showLoader&&G(t).isRangeChanged&&R(!0),k.current=setTimeout((function(){Q(t),L&&s.showLoader&&!s.lazy&&R(!1)}),s.delay)):Q(t)}}),ct,ut,at)})));g.displayName="VirtualScroller",g.defaultProps={__TYPE:"VirtualScroller",id:null,style:null,className:null,items:null,itemSize:0,scrollHeight:null,scrollWidth:null,orientation:"vertical",numToleratedItems:null,delay:0,lazy:!1,disabled:!1,loaderDisabled:!1,columns:null,loading:!1,showSpacer:!0,showLoader:!1,loadingTemplate:null,itemTemplate:null,contentTemplate:null,onScroll:null,onScrollIndexChange:null,onLazyLoad:null};export{g as VirtualScroller};
