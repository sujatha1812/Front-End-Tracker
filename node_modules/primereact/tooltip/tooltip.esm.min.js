import*as e from"react";import t from"primereact/api";import{useResizeListener as r,useOverlayScrollListener as n,useMountEffect as o,useUpdateEffect as i,useUnmountEffect as u}from"primereact/hooks";import{Portal as a}from"primereact/portal";import{DomHandler as c,ZIndexUtils as l,ObjectUtils as s,classNames as f}from"primereact/utils";function p(){return p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},p.apply(this,arguments)}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function h(e){if(Array.isArray(e))return d(e)}function m(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function v(e,t){if(e){if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(e,t):void 0}}function y(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function g(e){if(Array.isArray(e))return e}function b(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i=[],u=!0,a=!1;try{for(r=r.call(e);!(u=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);u=!0);}catch(e){a=!0,o=e}finally{try{u||null==r.return||r.return()}finally{if(a)throw o}}return i}}function E(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function w(e,t){return g(e)||b(e,t)||v(e,t)||E()}var T=e.memo(e.forwardRef((function(d,g){var b=w(e.useState(!1),2),E=b[0],x=b[1],S=w(e.useState(d.position),2),k=S[0],A=S[1],C=e.useRef(null),O=e.useRef(null),I=e.useRef(null),D=e.useRef(null),H=e.useRef(!0),L=e.useRef({}),N=w(r({listener:function(e){!c.isTouchDevice()&&G(e)}}),2),j=N[0],R=N[1],W=w(n({target:I.current,listener:function(e){G(e)},when:E}),2),P=W[0],B=W[1],Z=function(e){return _(e,"mousetrack")||d.mouseTrack},F=function(e){return"true"===_(e,"disabled")||z(e,"disabled")||d.disabled},M=function(e){return _(e,"showondisabled")||d.showOnDisabled},Y=function(){return _(I.current,"autohide")||d.autoHide},_=function(e,t){return z(e,"data-pr-".concat(t))?e.getAttribute("data-pr-".concat(t)):null},z=function(e,t){return e&&e.hasAttribute(t)},K=function(e){var t=_(e,"showevent")||d.showEvent,r=_(e,"hideevent")||d.hideEvent;Z(e)?(t="mousemove",r="mouseleave"):"focus"===(_(e,"event")||d.event)&&(t="focus",r="blur");return{showEvent:t,hideEvent:r}},U=function(e){return _(e,"position")||k},X=function(e){return{top:_(e,"mousetracktop")||d.mouseTrackTop,left:_(e,"mousetrackleft")||d.mouseTrackLeft}},$=function(e,t){if(O.current){var r=_(e,"tooltip")||d.content;r?(O.current.innerHTML="",O.current.appendChild(document.createTextNode(r)),t()):d.children&&t()}},q=function(e){I.current=e.currentTarget;var r,n=F(I.current);if(!(r=M(I.current)&&n?I.current.firstChild:I.current,!(d.content||_(r,"tooltip")||d.children))&&!n){var o=function(){$(I.current,(function(){d.autoZIndex&&!l.get(C.current)&&l.set("tooltip",C.current,t.autoZIndex,d.baseZIndex||t.zIndex.tooltip),C.current.style.left="",C.current.style.top="",Y()&&(C.current.style.pointerEvents="none"),Z(I.current)&&!D.current&&(D.current={width:c.getOuterWidth(C.current),height:c.getOuterHeight(C.current)}),J(I.current,{x:e.pageX,y:e.pageY})}))};if(E)ne("updateDelay",o);else oe(d.onBeforeShow,{originalEvent:e,target:I.current})&&ne("showDelay",(function(){x(!0),A(U(I.current)),setTimeout((function(){return o()}),0),oe(d.onShow,{originalEvent:e,target:I.current}),c.addClass(I.current,_(I.current,"classname"))}))}},G=function(e){(ie(),E)&&(c.removeClass(I.current,_(I.current,"classname")),oe(d.onBeforeHide,{originalEvent:e,target:I.current})&&ne("hideDelay",(function(){(Y()||!1!==H.current)&&(l.clear(C.current),c.removeClass(C.current,"p-tooltip-active"),x(!1),A(d.position),I.current=null,D.current=null,H.current=!0,oe(d.onHide,{originalEvent:e,target:I.current}))})))},J=function(e,t){var r=0,n=0;if(Z(e)&&t){var o={width:c.getOuterWidth(C.current),height:c.getOuterHeight(C.current)};r=t.x,n=t.y;var i=X(e),u=i.top,a=i.left;switch(k){case"left":r-=o.width+a,n-=o.height/2-u;break;case"right":r+=a,n-=o.height/2-u;break;case"top":r-=o.width/2-a,n-=o.height+u;break;case"bottom":r-=o.width/2-a,n+=u}r<=0||D.current.width>o.width?(C.current.style.left="0px",C.current.style.right=window.innerWidth-o.width-r+"px"):(C.current.style.right="",C.current.style.left=r+"px"),C.current.style.top=n+"px",c.addClass(C.current,"p-tooltip-active")}else{var l=c.findCollisionPosition(k),s=_(e,"my")||d.my||l.my,f=_(e,"at")||d.at||l.at;C.current.style.padding="0px",c.flipfitCollision(C.current,e,s,f,(function(e){var t=e.at,r=t.x,n=d.at?"center"!==r&&r!==e.my.x?r:t.y:e.at["".concat(l.axis)];C.current.style.padding="",A(n),Q(),c.addClass(C.current,"p-tooltip-active")}))}},Q=function(){if(C.current){var e=getComputedStyle(C.current);"left"===k?C.current.style.left=parseFloat(e.left)-2*parseFloat(e.paddingLeft)+"px":"top"===k&&(C.current.style.top=parseFloat(e.top)-2*parseFloat(e.paddingTop)+"px")}},V=function(){Y()||(H.current=!1)},ee=function(e){Y()||(H.current=!0,G(e))},te=function(e){if(e){var t=K(e),r=t.showEvent,n=t.hideEvent,o=ue(e);o.addEventListener(r,q),o.addEventListener(n,G)}},re=function(e){if(e){var t=K(e),r=t.showEvent,n=t.hideEvent,o=ue(e);o.removeEventListener(r,q),o.removeEventListener(n,G)}},ne=function(e,t){ie();var r=_(I.current,e.toLowerCase())||d[e];r?L.current["".concat(e)]=setTimeout((function(){return t()}),r):t()},oe=function(e){if(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var o=e.apply(void 0,r);return void 0===o&&(o=!0),o}return!0},ie=function(){Object.keys(L.current).forEach((function(e){return clearTimeout(e)}))},ue=function(e){if(e){if(M(e)){if(e.hasWrapper)return e.parentElement;var t=document.createElement("span");return e.parentNode.insertBefore(t,e),t.appendChild(e),e.hasWrapper=!0,t}var r;return e.hasWrapper&&((r=e.parentElement).replaceWith.apply(r,h(n=e.parentElement.childNodes)||m(n)||v(n)||y()),delete e.hasWrapper),e}var n;return null},ae=function(e){le(e),ce(e)},ce=function(e){se(e||d.target,te)},le=function(e){se(e||d.target,re)},se=function(e,t){if(e=s.getRefElement(e))if(c.isElement(e))t(e);else{var r=function(e){c.find(document,e).forEach((function(e){t(e)}))};e instanceof Array?e.forEach((function(e){r(e)})):r(e)}};e.useEffect((function(){E&&I.current&&F(I.current)&&G()})),o((function(){ce()})),i((function(){return ce(),function(){le()}}),[q,G,d.target]),i((function(){return E&&(j(),P()),function(){R(),B()}}),[E]),i((function(){E&&ne("updateDelay",(function(){$(I.current,(function(){J(I.current)}))}))}),[d.content]),u((function(){ie(),le(),l.clear(C.current)})),e.useImperativeHandle(g,(function(){return{updateTargetEvents:ae,loadTargetEvents:ce,unloadTargetEvents:le}}));var fe,pe,de,he,me,ve,ye;if(E){var ge=(me=s.findDiffKeys(d,T.defaultProps),ve=f("p-tooltip p-component",(fe={},pe="p-tooltip-".concat(k),de=!0,pe in fe?Object.defineProperty(fe,pe,{value:de,enumerable:!0,configurable:!0,writable:!0}):fe[pe]=de,fe),d.className),he=I.current,ye=!(d.content||_(he,"tooltip")),e.createElement("div",p({id:d.id,ref:C,className:ve,style:d.style,role:"tooltip","aria-hidden":E},me,{onMouseEnter:V,onMouseLeave:ee}),e.createElement("div",{className:"p-tooltip-arrow"}),e.createElement("div",{ref:O,className:"p-tooltip-text"},ye&&d.children)));return e.createElement(a,{element:ge,appendTo:d.appendTo,visible:!0})}return null})));T.displayName="Tooltip",T.defaultProps={__TYPE:"Tooltip",id:null,target:null,content:null,disabled:!1,className:null,style:null,appendTo:null,position:"right",my:null,at:null,event:null,showEvent:"mouseenter",hideEvent:"mouseleave",autoZIndex:!0,baseZIndex:0,mouseTrack:!1,mouseTrackTop:5,mouseTrackLeft:5,showDelay:0,updateDelay:0,hideDelay:0,autoHide:!0,showOnDisabled:!1,onBeforeShow:null,onBeforeHide:null,onShow:null,onHide:null};export{T as Tooltip};
