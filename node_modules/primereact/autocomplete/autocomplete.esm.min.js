import*as e from"react";import t from"primereact/api";import{Button as n}from"primereact/button";import{useOverlayListener as l,useMountEffect as o,useUpdateEffect as r,useUnmountEffect as i}from"primereact/hooks";import{InputText as a}from"primereact/inputtext";import{OverlayService as u}from"primereact/overlayservice";import{Tooltip as c}from"primereact/tooltip";import{classNames as p,ObjectUtils as s,UniqueComponentId as m,ZIndexUtils as d,DomHandler as f,IconUtils as g}from"primereact/utils";import{CSSTransition as v}from"primereact/csstransition";import{Portal as h}from"primereact/portal";import{Ripple as y}from"primereact/ripple";import{VirtualScroller as b}from"primereact/virtualscroller";function C(){return C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l])}return e},C.apply(this,arguments)}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,l=new Array(t);n<t;n++)l[n]=e[n];return l}function w(e){if(Array.isArray(e))return E(e)}function x(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function S(e,t){if(e){if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(e,t):void 0}}function k(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function O(e){if(Array.isArray(e))return e}function I(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var l,o,r=[],i=!0,a=!1;try{for(n=n.call(e);!(i=(l=n.next()).done)&&(r.push(l.value),!t||r.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(a)throw o}}return r}}function D(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function N(e,t){return O(e)||I(e,t)||S(e,t)||D()}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){T(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var F=e.memo(e.forwardRef((function(t,n){var l,o,r,i=function(e){return s.resolveFieldData(e,t.optionGroupLabel)},a=function(n,l){if(t.optionGroupLabel){var o=t.optionGroupTemplate?s.getJSXElement(t.optionGroupTemplate,n,l):t.getOptionGroupLabel(n),r=(u=l,t.getOptionGroupChildren(n).map((function(n,l){var o=u+"_"+l,r=t.selectedItem===n,i=t.itemTemplate?s.getJSXElement(t.itemTemplate,n,l):t.field?s.resolveFieldData(n,t.field):n;return e.createElement("li",{key:o,role:"option","aria-selected":r,className:"p-autocomplete-item",onClick:function(e){return t.onItemClick(e,n)},"data-group":u,"data-index":l},i,e.createElement(y,null))}))),a=l+"_"+i(n);return e.createElement(e.Fragment,{key:a},e.createElement("li",{className:"p-autocomplete-item-group"},o),r)}var u,c=t.itemTemplate?s.getJSXElement(t.itemTemplate,n,l):t.field?s.resolveFieldData(n,t.field):n;return e.createElement("li",{key:l,role:"option","aria-selected":t.selectedItem===n,className:"p-autocomplete-item",onClick:function(e){return t.onItemClick(e,n)}},c,e.createElement(y,null))},u=function(){if(t.virtualScrollerOptions){var n=j(j({},t.virtualScrollerOptions),{style:j(j({},t.virtualScrollerOptions.style),{height:t.scrollHeight}),items:t.suggestions,itemTemplate:function(e,t){return e&&a(e,t.index)},contentTemplate:function(n){var l=p("p-autocomplete-items",n.className);return e.createElement("ul",{ref:n.contentRef,className:l,role:"listbox",id:t.listId},n.children)}});return e.createElement(b,C({ref:t.virtualScrollerRef},n))}var l=t.suggestions?t.suggestions.map(a):null;return e.createElement("ul",{className:"p-autocomplete-items",role:"listbox",id:t.listId},l)},c=(l=p("p-autocomplete-panel p-component",t.panelClassName),o=j({maxHeight:t.scrollHeight},t.panelStyle||{}),r=u(),e.createElement(v,{nodeRef:n,classNames:"p-connected-overlay",in:t.in,timeout:{enter:120,exit:100},options:t.transitionOptions,unmountOnExit:!0,onEnter:t.onEnter,onEntering:t.onEntering,onEntered:t.onEntered,onExit:t.onExit,onExited:t.onExited},e.createElement("div",{ref:n,className:l,style:o,onClick:t.onClick},r)));return e.createElement(h,{element:c,appendTo:t.appendTo})})));F.displayName="AutoCompletePanel";var L=e.memo(e.forwardRef((function(v,h){var y=N(e.useState(v.id),2),b=y[0],E=y[1],O=N(e.useState(!1),2),I=O[0],D=O[1],T=N(e.useState(!1),2),P=T[0],j=T[1],R=N(e.useState(!1),2),M=R[0],G=R[1],A=e.useRef(null),K=e.useRef(null),U=e.useRef(v.inputRef),H=e.useRef(null),B=e.useRef(null),_=e.useRef(null),J=e.useRef(null),X=N(l({target:A,overlay:K,listener:function(e,t){t.valid&&("outside"===t.type?!V(e)&&te():te())},when:M}),2),q=X[0],z=X[1],V=function(e){return v.multiple?e.target===H.current||H.current.contains(e.target):e.target===U.current},Y=function(e){_.current&&clearTimeout(_.current);var t=e.target.value;v.multiple||Q(e,t),s.isEmpty(t)?(te(),v.onClear&&v.onClear(e)):t.length>=v.minLength?_.current=setTimeout((function(){Z(e,t,"input")}),v.delay):te()},Z=function(e,t,n){null!=t&&("input"===n&&0===t.trim().length||v.completeMethod&&(D(!0),v.completeMethod({originalEvent:e,query:t})))},$=function(e,t,n){if(v.multiple){if(U.current.value="",!ge(t)){var l=v.value?[].concat(w(o=v.value)||x(o)||S(o)||k(),[t]):[t];Q(e,l)}}else ee(t),Q(e,t);var o;v.onSelect&&v.onSelect({originalEvent:e,value:t}),n||(U.current.focus(),te())},Q=function(e,t){J&&J.current===t||(v.onChange&&v.onChange({originalEvent:e,value:t,stopPropagation:function(){},preventDefault:function(){},target:{name:v.name,id:b,value:t}}),J.current=t)},W=function(e){if(e){if(v.selectedItemTemplate&&(v.multiple?ge(e):ve(e)>-1)){var t=s.getJSXElement(v.selectedItemTemplate,e);return t||e}if(v.field){var n=s.resolveFieldData(e,v.field);return null!=n?n:e}return e}return""},ee=function(e){U.current.value=W(e)},te=function(){G(!1),D(!1)},ne=function(){f.alignOverlay(K.current,v.multiple?H.current:U.current,v.appendTo||t.appendTo)},le=function(e){v.dropdownAutoFocus&&U.current.focus(),"blank"===v.dropdownMode?Z(e,"","dropdown"):"current"===v.dropdownMode&&Z(e,U.current.value,"dropdown"),v.onDropdownClick&&v.onDropdownClick({originalEvent:e,query:U.current.value})},oe=function(e,t){var n=v.value[t],l=v.value.filter((function(e,n){return t!==n}));Q(e,l),v.onUnselect&&v.onUnselect({originalEvent:e,value:n})},re=function(e){if(M){var t=f.findSingle(K.current,"li.p-highlight");switch(e.which){case 40:if(t){var n=ae(t);n&&(f.addClass(n,"p-highlight"),f.removeClass(t,"p-highlight"),f.scrollInView(K.current,n))}else t=f.findSingle(K.current,"li"),f.hasClass(t,"p-autocomplete-item-group")&&(t=ae(t)),t&&f.addClass(t,"p-highlight");e.preventDefault();break;case 38:if(t){var l=ue(t);l&&(f.addClass(l,"p-highlight"),f.removeClass(t,"p-highlight"),f.scrollInView(K.current,l))}e.preventDefault();break;case 13:t&&(ie(e,t),te()),e.preventDefault();break;case 27:te(),e.preventDefault();break;case 9:t&&ie(e,t),te()}}if(v.multiple&&8===e.which)if(v.value&&v.value.length&&!U.current.value){var o=v.value[v.value.length-1],r=v.value.slice(0,-1);Q(e,r),v.onUnselect&&v.onUnselect({originalEvent:e,value:o})}},ie=function(e,t){v.optionGroupLabel?$(e,he(v.suggestions[t.dataset.group])[t.dataset.index]):$(e,v.suggestions[f.index(t)])},ae=function e(t){var n=t.nextElementSibling;return n?f.hasClass(n,"p-autocomplete-item-group")?e(n):n:null},ue=function e(t){var n=t.previousElementSibling;return n?f.hasClass(n,"p-autocomplete-item-group")?e(n):n:null},ce=function(e){j(!0),v.onFocus&&v.onFocus(e)},pe=function(e){var t=e.target.value.trim(),n=(v.suggestions||[]).find((function(e){var n=v.field?s.resolveFieldData(e,v.field):e;return n&&t===n.trim()}));n?$(e,n,!0):(U.current.value="",Q(e,null),v.onClear&&v.onClear(e))},se=function(e){j(!1),v.forceSelection&&pe(e),v.onBlur&&v.onBlur(e)},me=function(e){U.current.focus(),v.onClick&&v.onClick(e)},de=function(e){ce(e),f.addClass(H.current,"p-focus")},fe=function(e){se(e),f.removeClass(H.current,"p-focus")},ge=function(e){return!!v.value&&v.value.some((function(t){return s.equals(t,e)}))},ve=function(e){return v.suggestions?v.suggestions.findIndex((function(t){return s.equals(t,e)})):-1},he=function(e){return s.resolveFieldData(e,v.optionGroupChildren)};e.useEffect((function(){s.combinedRefs(U,v.inputRef)}),[U,v.inputRef]),o((function(){b||E(m()),v.autoFocus&&U.current&&U.current.focus()})),r((function(){I&&(s.isNotEmpty(v.suggestions)?G(!0):te(),D(!1))}),[v.suggestions]),r((function(){U.current&&!v.multiple&&ee(v.value)})),i((function(){_.current&&clearTimeout(_.current),d.clear(K.current)})),e.useImperativeHandle(h,(function(){return{search:Z}}));var ye=function(){var t=W(v.value),n=b+"_list",l=p("p-autocomplete-input",v.inputClassName,{"p-autocomplete-dd-input":v.dropdown});return e.createElement(a,{ref:U,id:v.inputId,type:v.type,name:v.name,defaultValue:t,role:"searchbox","aria-autocomplete":"list","aria-controls":n,"aria-labelledby":v.ariaLabelledBy,className:l,style:v.inputStyle,autoComplete:"off",readOnly:v.readOnly,disabled:v.disabled,placeholder:v.placeholder,size:v.size,maxLength:v.maxLength,tabIndex:v.tabIndex,onBlur:se,onFocus:ce,onChange:Y,onMouseDown:v.onMouseDown,onKeyUp:v.onKeyUp,onKeyDown:re,onKeyPress:v.onKeyPress,onContextMenu:v.onContextMenu,onClick:v.onClick,onDoubleClick:v.onDblClick})},be=function(){var t=p("p-autocomplete-multiple-container p-component p-inputtext",{"p-disabled":v.disabled}),n=s.isNotEmpty(v.value)?v.value.map((function(t,n){return e.createElement("li",{key:n+"multi-item",className:"p-autocomplete-token p-highlight"},e.createElement("span",{className:"p-autocomplete-token-label"},W(t)),!v.disabled&&g.getJSXIcon(v.removeIcon,{className:"p-autocomplete-token-icon",onClick:function(e){return oe(e,n)}},{props:v}))})):null;return e.createElement("ul",{ref:H,className:t,onContextMenu:v.onContextMenu,onMouseDown:v.onMouseDown,onClick:me,onDoubleClick:v.onDblClick},n,e.createElement("li",{className:"p-autocomplete-input-token"},e.createElement("input",{ref:U,type:v.type,disabled:v.disabled,placeholder:v.placeholder,role:"searchbox","aria-autocomplete":"list","aria-controls":b+"_list","aria-labelledby":v.ariaLabelledBy,autoComplete:"off",tabIndex:v.tabIndex,onChange:Y,id:v.inputId,name:v.name,style:v.inputStyle,className:v.inputClassName,maxLength:v.maxLength,onKeyUp:v.onKeyUp,onKeyDown:re,onKeyPress:v.onKeyPress,onFocus:de,onBlur:fe})))},Ce=b+"_list",Ee=s.isNotEmpty(v.tooltip),we=s.findDiffKeys(v,L.defaultProps),xe=p("p-autocomplete p-component p-inputwrapper",{"p-autocomplete-dd":v.dropdown,"p-autocomplete-multiple":v.multiple,"p-inputwrapper-filled":v.value,"p-inputwrapper-focus":P},v.className),Se=I?e.createElement("i",{className:"p-autocomplete-loader pi pi-spinner pi-spin"}):null,ke=v.multiple?be():ye(),Oe=v.dropdown?e.createElement(n,{type:"button",icon:v.dropdownIcon,className:"p-autocomplete-dropdown",disabled:v.disabled,onClick:le}):null;return e.createElement(e.Fragment,null,e.createElement("span",C({ref:A,id:b,style:v.style,className:xe,"aria-haspopup":"listbox","aria-expanded":M,"aria-owns":Ce},we),ke,Se,Oe,e.createElement(F,C({ref:K,virtualScrollerRef:B},v,{listId:Ce,onItemClick:$,selectedItem:J,onClick:function(e){u.emit("overlay-click",{originalEvent:e,target:A.current})},getOptionGroupLabel:function(e){return v.optionGroupLabel?s.resolveFieldData(e,v.optionGroupLabel):e},getOptionGroupChildren:he,in:M,onEnter:function(){d.set("overlay",K.current,t.autoZIndex,t.zIndex.overlay),ne()},onEntering:function(){v.autoHighlight&&v.suggestions&&v.suggestions.length&&f.addClass(K.current.firstChild.firstChild,"p-highlight")},onEntered:function(){q(),v.onShow&&v.onShow()},onExit:function(){z()},onExited:function(){d.clear(K.current),v.onHide&&v.onHide()}}))),Ee&&e.createElement(c,C({target:A,content:v.tooltip},v.tooltipOptions)))})));L.displayName="AutoComplete",L.defaultProps={__TYPE:"AutoComplete",id:null,inputRef:null,value:null,name:null,type:"text",suggestions:null,field:null,optionGroupLabel:null,optionGroupChildren:null,optionGroupTemplate:null,forceSelection:!1,autoHighlight:!1,virtualScrollerOptions:null,scrollHeight:"200px",dropdown:!1,dropdownMode:"blank",dropdownAutoFocus:!0,multiple:!1,minLength:1,delay:300,style:null,className:null,inputId:null,inputStyle:null,inputClassName:null,panelClassName:null,panelStyle:null,placeholder:null,readOnly:!1,disabled:!1,maxLength:null,size:null,appendTo:null,tabIndex:null,autoFocus:!1,tooltip:null,tooltipOptions:null,ariaLabelledBy:null,completeMethod:null,itemTemplate:null,selectedItemTemplate:null,transitionOptions:null,dropdownIcon:"pi pi-chevron-down",removeIcon:"pi pi-times-circle",onChange:null,onFocus:null,onBlur:null,onSelect:null,onUnselect:null,onDropdownClick:null,onClick:null,onDblClick:null,onMouseDown:null,onKeyUp:null,onKeyPress:null,onContextMenu:null,onClear:null,onShow:null,onHide:null};export{L as AutoComplete};
