"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("primereact/api"),n=require("primereact/button"),l=require("primereact/messages"),a=require("primereact/progressbar"),r=require("primereact/ripple"),o=require("primereact/utils");function i(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var l=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,l.get?l:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var s=i(e);function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l])}return e},c.apply(this,arguments)}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,l=new Array(t);n<t;n++)l[n]=e[n];return l}function p(e){if(Array.isArray(e))return u(e)}function d(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function m(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function f(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function y(e){return p(e)||d(e)||m(e)||f()}function b(e){if(Array.isArray(e))return e}function v(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var l,a,r=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(l=n.next()).done)&&(r.push(l.value),!t||r.length!==t);o=!0);}catch(e){i=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(i)throw a}}return r}}function h(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function g(e,t){return b(e)||v(e,t)||m(e,t)||h()}function E(e){throw new TypeError('"'+e+'" is read-only')}function S(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=O(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var l=0,a=function(){};return{s:a,n:function(){return l>=e.length?{done:!0}:{done:!1,value:e[l++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,r=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw r}}}}function O(e,t){if(e){if("string"==typeof e)return N(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?N(e,t):void 0}}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,l=new Array(t);n<t;n++)l[n]=e[n];return l}var w=s.memo(s.forwardRef((function(e,i){var u=g(s.useState([]),2),p=u[0],d=u[1],m=g(s.useState(0),2),f=m[0],b=m[1],v=g(s.useState(!1),2),h=v[0],O=v[1],N=s.useRef(null),B=s.useRef(null),T=s.useRef(null),U=s.useRef(!1),j=s.useRef(0),C=o.ObjectUtils.isNotEmpty(p),F=e.chooseLabel||e.chooseOptions.label||t.localeOption("choose"),M=e.uploadLabel||e.uploadOptions.label||t.localeOption("upload"),z=e.cancelLabel||e.cancelOptions.label||t.localeOption("cancel"),D=e.disabled||e.fileLimit&&e.fileLimit<=p.length+j,I=e.disabled||!C,L=e.disabled||!C,x=function(e){return/^image\//.test(e.type)},P=function(t,n){R();var l=y(p),a=p[n];l.splice(n,1),d(l),e.onRemove&&e.onRemove({originalEvent:t,file:a})},R=function(){N.current&&(N.current.value="")},A=function(e){if(0===e)return"0 B";var t=Math.floor(Math.log(e)/Math.log(1e3));return parseFloat((e/Math.pow(1e3,t)).toFixed(3))+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t]},k=function(t){if("drop"!==t.type&&_()&&U.current)U.current=!1;else{for(var n=p?y(p):[],l=t.dataTransfer?t.dataTransfer.files:t.target.files,a=0;a<l.length;a++){var r=l[a];!H(r)&&q(r)&&(x(r)&&(r.objectURL=window.URL.createObjectURL(r)),n.push(r))}d(n),o.ObjectUtils.isNotEmpty(n)&&e.auto&&X(n),e.onSelect&&e.onSelect({originalEvent:t,files:l}),"drop"!==t.type&&_()?N.current&&(U.current=!0,N.current.value=""):R(),"basic"===e.mode&&n.length>0&&(N.current.style.display="none")}},H=function(e){return p.some((function(t){return t.name+t.type+t.size===e.name+e.type+e.size}))},_=function(){return!!window.MSInputMethodContext&&!!document.documentMode},q=function(t){if(e.maxFileSize&&t.size>e.maxFileSize){var n={severity:"error",summary:e.invalidFileSizeMessageSummary.replace("{0}",t.name),detail:e.invalidFileSizeMessageDetail.replace("{0}",A(e.maxFileSize)),sticky:!0};return"advanced"===e.mode&&B.current.show(n),e.onValidationFail&&e.onValidationFail(t),!1}return!0},X=function(t){if(t=t||p,e.customUpload)e.fileLimit&&E("uploadedFileCount"),e.uploadHandler&&e.uploadHandler({files:t,options:{clear:J,props:e}});else{var n=new XMLHttpRequest,l=new FormData;e.onBeforeUpload&&e.onBeforeUpload({xhr:n,formData:l});var a,r=S(t);try{for(r.s();!(a=r.n()).done;){var o=a.value;l.append(e.name,o,o.name)}}catch(e){r.e(e)}finally{r.f()}n.upload.addEventListener("progress",(function(t){if(t.lengthComputable){var n=Math.round(100*t.loaded/t.total);b(n),e.onProgress&&e.onProgress({originalEvent:t,progress:n})}})),n.onreadystatechange=function(){4===n.readyState&&(b(0),n.status>=200&&n.status<300?(e.fileLimit&&E("uploadedFileCount"),e.onUpload&&e.onUpload({xhr:n,files:t})):e.onError&&e.onError({xhr:n,files:t}),J())},n.open("POST",e.url,!0),e.onBeforeSend&&e.onBeforeSend({xhr:n,formData:l}),n.withCredentials=e.withCredentials,n.send(l)}},J=function(){d([]),e.onClear&&e.onClear(),R()},K=function(){N.current.click()},V=function(){O(!0)},W=function(){O(!1)},Y=function(e){13===e.which&&K()},$=function(t){e.disabled||(t.dataTransfer.dropEffect="copy",t.stopPropagation(),t.preventDefault())},G=function(t){e.disabled||(t.dataTransfer.dropEffect="copy",o.DomHandler.addClass(T.current,"p-fileupload-highlight"),t.stopPropagation(),t.preventDefault())},Z=function(t){e.disabled||(t.dataTransfer.dropEffect="copy",o.DomHandler.removeClass(T.current,"p-fileupload-highlight"))},Q=function(t){if(!e.disabled){o.DomHandler.removeClass(T.current,"p-fileupload-highlight"),t.stopPropagation(),t.preventDefault();var n=t.dataTransfer?t.dataTransfer.files:t.target.files;(e.multiple||n&&0===n.length)&&k(t)}},ee=function(){C?X():N.current.click()};s.useImperativeHandle(i,(function(){return{upload:X,clear:J,formatSize:A}}));var te,ne,le,ae,re,oe,ie,se,ce,ue,pe=function(t,l){var a=t.name+t.type+t.size,r=x(t)?s.createElement("div",null,s.createElement("img",{alt:t.name,role:"presentation",src:t.objectURL,width:e.previewWidth})):null,i=s.createElement("div",{className:"p-fileupload-filename"},t.name),c=s.createElement("div",null,A(t.size)),u=s.createElement("div",null,s.createElement(n.Button,{type:"button",icon:"pi pi-times",onClick:function(e){return P(e,l)}})),p=s.createElement(s.Fragment,null,r,i,c,u);if(e.itemTemplate){var d={onRemove:function(e){return P(e,l)},previewElement:r,fileNameElement:i,sizeElement:c,removeElement:u,formatSize:A(t.size),element:p,props:e};p=o.ObjectUtils.getJSXElement(e.itemTemplate,t,d)}return s.createElement("div",{className:"p-fileupload-row",key:a},p)};return"advanced"===e.mode?function(){var t,i,u,d,m,y,b,v,g,E,S,O,U,j,x=o.ObjectUtils.findDiffKeys(e,w.defaultProps),P=o.classNames("p-fileupload p-fileupload-advanced p-component",e.className),R=o.classNames("p-fileupload-buttonbar",e.headerClassName),A=o.classNames("p-fileupload-content",e.contentClassName),H=(i=(t=e.chooseOptions).style,u=t.icon,m=o.classNames("p-button p-fileupload-choose p-component",{"p-disabled":e.disabled,"p-focus":h,"p-button-icon-only":d=t.iconOnly},t.className),y="p-button-label p-clickable",b=d?s.createElement("span",{className:y,dangerouslySetInnerHTML:{__html:"&nbsp;"}}):s.createElement("span",{className:y},F),v=s.createElement("input",{ref:N,type:"file",onChange:k,multiple:e.multiple,accept:e.accept,disabled:D}),g=o.IconUtils.getJSXIcon(u||"pi pi-fw pi-plus",{className:"p-button-icon p-button-icon-left p-clickable"},{props:e}),s.createElement("span",{className:m,style:i,onClick:K,onKeyDown:Y,onFocus:V,onBlur:W,tabIndex:0},v,g,b,s.createElement(r.Ripple,null))),_=e.emptyTemplate&&!C?o.ObjectUtils.getJSXElement(e.emptyTemplate,e):null;if(!e.auto){var q=e.uploadOptions,ee=e.cancelOptions,te=ee.iconOnly?"":z;E=s.createElement(n.Button,{type:"button",label:q.iconOnly?"":M,icon:q.icon||"pi pi-upload",onClick:X,disabled:I,style:q.style,className:q.className}),S=s.createElement(n.Button,{type:"button",label:te,icon:ee.icon||"pi pi-times",onClick:J,disabled:L,style:ee.style,className:ee.className})}C&&(j=p.map(pe),O=s.createElement("div",{className:"p-fileupload-files"},j),U=e.progressBarTemplate?o.ObjectUtils.getJSXElement(e.progressBarTemplate,e):s.createElement(a.ProgressBar,{value:f,showValue:!1}));var ne=s.createElement("div",{className:R,style:e.headerStyle},H,E,S);e.headerTemplate&&(ne=o.ObjectUtils.getJSXElement(e.headerTemplate,{className:R,chooseButton:H,uploadButton:E,cancelButton:S,element:ne,props:e}));return s.createElement("div",c({id:e.id,className:P,style:e.style},x),ne,s.createElement("div",{ref:T,className:A,style:e.contentStyle,onDragEnter:$,onDragOver:G,onDragLeave:Z,onDrop:Q},U,s.createElement(l.Messages,{ref:B}),O,_))}():"basic"===e.mode?(te=e.chooseOptions,ne=o.ObjectUtils.findDiffKeys(e,w.defaultProps),le=o.classNames("p-fileupload p-fileupload-basic p-component",e.className),ae=o.classNames("p-button p-component p-fileupload-choose",{"p-fileupload-choose-selected":C,"p-disabled":e.disabled,"p-focus":h},te.className),re=te.icon||o.classNames({"pi pi-plus":!te.icon&&(!C||e.auto),"pi pi-upload":!te.icon&&C&&!e.auto}),oe="p-button-label p-clickable",ie=te.iconOnly?s.createElement("span",{className:oe,dangerouslySetInnerHTML:{__html:"&nbsp;"}}):s.createElement("span",{className:oe},F),se=e.auto?ie:s.createElement("span",{className:oe},C?p[0].name:ie),ce=o.IconUtils.getJSXIcon(re,{className:"p-button-icon p-button-icon-left"},{props:e,hasFiles:C}),ue=!C&&s.createElement("input",{ref:N,type:"file",accept:e.accept,multiple:e.multiple,disabled:e.disabled,onChange:k}),s.createElement("div",c({className:le,style:e.style},ne),s.createElement(l.Messages,{ref:B}),s.createElement("span",{className:ae,style:te.style,onMouseUp:ee,onKeyDown:Y,onFocus:V,onBlur:W,tabIndex:0},ce,se,ue,s.createElement(r.Ripple,null)))):void 0})));w.displayName="FileUpload",w.defaultProps={__TYPE:"FileUpload",id:null,name:null,url:null,mode:"advanced",multiple:!1,accept:null,disabled:!1,auto:!1,maxFileSize:null,invalidFileSizeMessageSummary:"{0}: Invalid file size, ",invalidFileSizeMessageDetail:"maximum upload size is {0}.",style:null,className:null,widthCredentials:!1,previewWidth:50,chooseLabel:null,uploadLabel:null,cancelLabel:null,chooseOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},uploadOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},cancelOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},customUpload:!1,headerClassName:null,headerStyle:null,contentClassName:null,contentStyle:null,headerTemplate:null,itemTemplate:null,emptyTemplate:null,progressBarTemplate:null,onBeforeUpload:null,onBeforeSend:null,onUpload:null,onError:null,onClear:null,onSelect:null,onProgress:null,onValidationFail:null,uploadHandler:null,onRemove:null},exports.FileUpload=w;
