import*as e from"react";import{localeOption as t}from"primereact/api";import{Button as n}from"primereact/button";import{Messages as l}from"primereact/messages";import{ProgressBar as a}from"primereact/progressbar";import{Ripple as r}from"primereact/ripple";import{ObjectUtils as o,classNames as i,IconUtils as s,DomHandler as u}from"primereact/utils";function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l])}return e},c.apply(this,arguments)}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,l=new Array(t);n<t;n++)l[n]=e[n];return l}function m(e){if(Array.isArray(e))return p(e)}function d(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function f(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}function y(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function b(e){return m(e)||d(e)||f(e)||y()}function v(e){if(Array.isArray(e))return e}function h(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var l,a,r=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(l=n.next()).done)&&(r.push(l.value),!t||r.length!==t);o=!0);}catch(e){i=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(i)throw a}}return r}}function g(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function E(e,t){return v(e)||h(e,t)||f(e,t)||g()}function S(e){throw new TypeError('"'+e+'" is read-only')}function N(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=w(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var l=0,a=function(){};return{s:a,n:function(){return l>=e.length?{done:!0}:{done:!1,value:e[l++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,r=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw r}}}}function w(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,l=new Array(t);n<t;n++)l[n]=e[n];return l}var O=e.memo(e.forwardRef((function(p,m){var d=E(e.useState([]),2),f=d[0],y=d[1],v=E(e.useState(0),2),h=v[0],g=v[1],w=E(e.useState(!1),2),T=w[0],C=w[1],B=e.useRef(null),F=e.useRef(null),z=e.useRef(null),L=e.useRef(!1),M=e.useRef(0),I=o.isNotEmpty(f),U=p.chooseLabel||p.chooseOptions.label||t("choose"),x=p.uploadLabel||p.uploadOptions.label||t("upload"),D=p.cancelLabel||p.cancelOptions.label||t("cancel"),A=p.disabled||p.fileLimit&&p.fileLimit<=f.length+M,R=p.disabled||!I,P=p.disabled||!I,j=function(e){return/^image\//.test(e.type)},k=function(e,t){H();var n=b(f),l=f[t];n.splice(t,1),y(n),p.onRemove&&p.onRemove({originalEvent:e,file:l})},H=function(){B.current&&(B.current.value="")},X=function(e){if(0===e)return"0 B";var t=Math.floor(Math.log(e)/Math.log(1e3));return parseFloat((e/Math.pow(1e3,t)).toFixed(3))+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t]},J=function(e){if("drop"!==e.type&&K()&&L.current)L.current=!1;else{for(var t=f?b(f):[],n=e.dataTransfer?e.dataTransfer.files:e.target.files,l=0;l<n.length;l++){var a=n[l];!_(a)&&V(a)&&(j(a)&&(a.objectURL=window.URL.createObjectURL(a)),t.push(a))}y(t),o.isNotEmpty(t)&&p.auto&&W(t),p.onSelect&&p.onSelect({originalEvent:e,files:n}),"drop"!==e.type&&K()?B.current&&(L.current=!0,B.current.value=""):H(),"basic"===p.mode&&t.length>0&&(B.current.style.display="none")}},_=function(e){return f.some((function(t){return t.name+t.type+t.size===e.name+e.type+e.size}))},K=function(){return!!window.MSInputMethodContext&&!!document.documentMode},V=function(e){if(p.maxFileSize&&e.size>p.maxFileSize){var t={severity:"error",summary:p.invalidFileSizeMessageSummary.replace("{0}",e.name),detail:p.invalidFileSizeMessageDetail.replace("{0}",X(p.maxFileSize)),sticky:!0};return"advanced"===p.mode&&F.current.show(t),p.onValidationFail&&p.onValidationFail(e),!1}return!0},W=function(e){if(e=e||f,p.customUpload)p.fileLimit&&S("uploadedFileCount"),p.uploadHandler&&p.uploadHandler({files:e,options:{clear:Y,props:p}});else{var t=new XMLHttpRequest,n=new FormData;p.onBeforeUpload&&p.onBeforeUpload({xhr:t,formData:n});var l,a=N(e);try{for(a.s();!(l=a.n()).done;){var r=l.value;n.append(p.name,r,r.name)}}catch(e){a.e(e)}finally{a.f()}t.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);g(t),p.onProgress&&p.onProgress({originalEvent:e,progress:t})}})),t.onreadystatechange=function(){4===t.readyState&&(g(0),t.status>=200&&t.status<300?(p.fileLimit&&S("uploadedFileCount"),p.onUpload&&p.onUpload({xhr:t,files:e})):p.onError&&p.onError({xhr:t,files:e}),Y())},t.open("POST",p.url,!0),p.onBeforeSend&&p.onBeforeSend({xhr:t,formData:n}),t.withCredentials=p.withCredentials,t.send(n)}},Y=function(){y([]),p.onClear&&p.onClear(),H()},$=function(){B.current.click()},q=function(){C(!0)},G=function(){C(!1)},Z=function(e){13===e.which&&$()},Q=function(e){p.disabled||(e.dataTransfer.dropEffect="copy",e.stopPropagation(),e.preventDefault())},ee=function(e){p.disabled||(e.dataTransfer.dropEffect="copy",u.addClass(z.current,"p-fileupload-highlight"),e.stopPropagation(),e.preventDefault())},te=function(e){p.disabled||(e.dataTransfer.dropEffect="copy",u.removeClass(z.current,"p-fileupload-highlight"))},ne=function(e){if(!p.disabled){u.removeClass(z.current,"p-fileupload-highlight"),e.stopPropagation(),e.preventDefault();var t=e.dataTransfer?e.dataTransfer.files:e.target.files;(p.multiple||t&&0===t.length)&&J(e)}},le=function(){I?W():B.current.click()};e.useImperativeHandle(m,(function(){return{upload:W,clear:Y,formatSize:X}}));var ae,re,oe,ie,se,ue,ce,pe,me,de,fe=function(t,l){var a=t.name+t.type+t.size,r=j(t)?e.createElement("div",null,e.createElement("img",{alt:t.name,role:"presentation",src:t.objectURL,width:p.previewWidth})):null,i=e.createElement("div",{className:"p-fileupload-filename"},t.name),s=e.createElement("div",null,X(t.size)),u=e.createElement("div",null,e.createElement(n,{type:"button",icon:"pi pi-times",onClick:function(e){return k(e,l)}})),c=e.createElement(e.Fragment,null,r,i,s,u);if(p.itemTemplate){var m={onRemove:function(e){return k(e,l)},previewElement:r,fileNameElement:i,sizeElement:s,removeElement:u,formatSize:X(t.size),element:c,props:p};c=o.getJSXElement(p.itemTemplate,t,m)}return e.createElement("div",{className:"p-fileupload-row",key:a},c)};return"advanced"===p.mode?function(){var t,u,m,d,y,b,v,g,E,S,N,w,C,L,M=o.findDiffKeys(p,O.defaultProps),j=i("p-fileupload p-fileupload-advanced p-component",p.className),k=i("p-fileupload-buttonbar",p.headerClassName),H=i("p-fileupload-content",p.contentClassName),X=(u=(t=p.chooseOptions).style,m=t.icon,y=i("p-button p-fileupload-choose p-component",{"p-disabled":p.disabled,"p-focus":T,"p-button-icon-only":d=t.iconOnly},t.className),b="p-button-label p-clickable",v=d?e.createElement("span",{className:b,dangerouslySetInnerHTML:{__html:"&nbsp;"}}):e.createElement("span",{className:b},U),g=e.createElement("input",{ref:B,type:"file",onChange:J,multiple:p.multiple,accept:p.accept,disabled:A}),E=s.getJSXIcon(m||"pi pi-fw pi-plus",{className:"p-button-icon p-button-icon-left p-clickable"},{props:p}),e.createElement("span",{className:y,style:u,onClick:$,onKeyDown:Z,onFocus:q,onBlur:G,tabIndex:0},g,E,v,e.createElement(r,null))),_=p.emptyTemplate&&!I?o.getJSXElement(p.emptyTemplate,p):null;if(!p.auto){var K=p.uploadOptions,V=p.cancelOptions,le=V.iconOnly?"":D;S=e.createElement(n,{type:"button",label:K.iconOnly?"":x,icon:K.icon||"pi pi-upload",onClick:W,disabled:R,style:K.style,className:K.className}),N=e.createElement(n,{type:"button",label:le,icon:V.icon||"pi pi-times",onClick:Y,disabled:P,style:V.style,className:V.className})}I&&(L=f.map(fe),w=e.createElement("div",{className:"p-fileupload-files"},L),C=p.progressBarTemplate?o.getJSXElement(p.progressBarTemplate,p):e.createElement(a,{value:h,showValue:!1}));var ae=e.createElement("div",{className:k,style:p.headerStyle},X,S,N);p.headerTemplate&&(ae=o.getJSXElement(p.headerTemplate,{className:k,chooseButton:X,uploadButton:S,cancelButton:N,element:ae,props:p}));return e.createElement("div",c({id:p.id,className:j,style:p.style},M),ae,e.createElement("div",{ref:z,className:H,style:p.contentStyle,onDragEnter:Q,onDragOver:ee,onDragLeave:te,onDrop:ne},C,e.createElement(l,{ref:F}),w,_))}():"basic"===p.mode?(ae=p.chooseOptions,re=o.findDiffKeys(p,O.defaultProps),oe=i("p-fileupload p-fileupload-basic p-component",p.className),ie=i("p-button p-component p-fileupload-choose",{"p-fileupload-choose-selected":I,"p-disabled":p.disabled,"p-focus":T},ae.className),se=ae.icon||i({"pi pi-plus":!ae.icon&&(!I||p.auto),"pi pi-upload":!ae.icon&&I&&!p.auto}),ue="p-button-label p-clickable",ce=ae.iconOnly?e.createElement("span",{className:ue,dangerouslySetInnerHTML:{__html:"&nbsp;"}}):e.createElement("span",{className:ue},U),pe=p.auto?ce:e.createElement("span",{className:ue},I?f[0].name:ce),me=s.getJSXIcon(se,{className:"p-button-icon p-button-icon-left"},{props:p,hasFiles:I}),de=!I&&e.createElement("input",{ref:B,type:"file",accept:p.accept,multiple:p.multiple,disabled:p.disabled,onChange:J}),e.createElement("div",c({className:oe,style:p.style},re),e.createElement(l,{ref:F}),e.createElement("span",{className:ie,style:ae.style,onMouseUp:le,onKeyDown:Z,onFocus:q,onBlur:G,tabIndex:0},me,pe,de,e.createElement(r,null)))):void 0})));O.displayName="FileUpload",O.defaultProps={__TYPE:"FileUpload",id:null,name:null,url:null,mode:"advanced",multiple:!1,accept:null,disabled:!1,auto:!1,maxFileSize:null,invalidFileSizeMessageSummary:"{0}: Invalid file size, ",invalidFileSizeMessageDetail:"maximum upload size is {0}.",style:null,className:null,widthCredentials:!1,previewWidth:50,chooseLabel:null,uploadLabel:null,cancelLabel:null,chooseOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},uploadOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},cancelOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},customUpload:!1,headerClassName:null,headerStyle:null,contentClassName:null,contentStyle:null,headerTemplate:null,itemTemplate:null,emptyTemplate:null,progressBarTemplate:null,onBeforeUpload:null,onBeforeSend:null,onUpload:null,onError:null,onClear:null,onSelect:null,onProgress:null,onValidationFail:null,uploadHandler:null,onRemove:null};export{O as FileUpload};
