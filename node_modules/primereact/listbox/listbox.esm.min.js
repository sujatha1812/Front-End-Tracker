import*as e from"react";import{FilterService as t}from"primereact/api";import{Tooltip as n}from"primereact/tooltip";import{classNames as r,ObjectUtils as l,DomHandler as o}from"primereact/utils";import{VirtualScroller as a}from"primereact/virtualscroller";import{InputText as i}from"primereact/inputtext";import{Ripple as u}from"primereact/ripple";function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c.apply(this,arguments)}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function f(e){if(Array.isArray(e))return p(e)}function m(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function d(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}function b(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function v(e){return f(e)||m(e)||d(e)||b()}function y(e){if(Array.isArray(e))return e}function h(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o=[],a=!0,i=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){i=!0,l=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw l}}return o}}function g(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var E=e.memo((function(t){return e.createElement("div",{className:"p-listbox-header"},e.createElement("div",{className:"p-listbox-filter-container"},e.createElement(i,{type:"text",value:t.filter,onChange:function(e){t.onFilter&&t.onFilter({originalEvent:e,value:e.target.value})},className:"p-listbox-filter",disabled:t.disabled,placeholder:t.filterPlaceholder}),e.createElement("span",{className:"p-listbox-filter-icon pi pi-search"})))}));E.displayName="ListBoxHeader";var x=e.memo((function(t){var n=function(e){t.onClick&&t.onClick({originalEvent:e,option:t.option}),e.preventDefault()},a=function e(t){var n=t.nextElementSibling;return n?o.hasClass(n,"p-disabled")||o.hasClass(n,"p-listbox-item-group")?e(n):n:null},i=function e(t){var n=t.previousElementSibling;return n?o.hasClass(n,"p-disabled")||o.hasClass(n,"p-listbox-item-group")?e(n):n:null},c=r("p-listbox-item",{"p-highlight":t.selected,"p-disabled":t.disabled},t.option.className),s=t.template?l.getJSXElement(t.template,t.option):t.label;return e.createElement("li",{className:c,onClick:n,onTouchEnd:function(e){t.onTouchEnd&&t.onTouchEnd({originalEvent:e,option:t.option})},onKeyDown:function(e){var t=e.currentTarget;switch(e.which){case 40:var r=a(t);r&&r.focus(),e.preventDefault();break;case 38:var l=i(t);l&&l.focus(),e.preventDefault();break;case 13:n(e),e.preventDefault()}},tabIndex:t.tabIndex,"aria-label":t.label,key:t.label,role:"option","aria-selected":t.selected},s,e.createElement(u,null))}));function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=C(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,l=function(){};return{s:l,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function C(e,t){if(e){if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(e,t):void 0}}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}x.displayName="ListBoxItem";var L=e.memo(e.forwardRef((function(o,i){var u,s,p=e.useState(""),f=(s=2,y(u=p)||h(u,s)||d(u,s)||g()),m=f[0],b=f[1],O=e.useRef(null),C=e.useRef(null),D=e.useRef(!1),j=(o.onFilterValueChange?o.filterValue:m)||"",N=j&&j.trim().length>0,P=function(e){var t=e.option;o.disabled||R(t)||(o.multiple?I(e.originalEvent,t):F(e.originalEvent,t),D.current=!1)},T=function(){o.disabled||(D.current=!0)},F=function(e,t){var n=G(t),r=!1,l=null;!D.current&&o.metaKeySelection?n?(e.metaKey||e.ctrlKey)&&(l=null,r=!0):(l=B(t),r=!0):(l=n?null:B(t),r=!0);r&&K(e,l)},I=function(e,t){var n=G(t),r=!1,l=null;if(!D&&o.metaKeySelection){var a=e.metaKey||e.ctrlKey;n?(l=a?k(t):[B(t)],r=!0):(l=[].concat(v(l=a&&o.value||[]),[B(t)]),r=!0)}else l=n?k(t):[].concat(v(o.value||[]),[B(t)]),r=!0;r&&o.onChange({originalEvent:e,value:l,stopPropagation:function(){},preventDefault:function(){},target:{name:o.name,id:o.id,value:l}})},A=function(e){var t=e.value;o.onFilterValueChange?o.onFilterValueChange({originalEvent:e.originalEvent,value:t}):b(t)},K=function(e,t){o.onChange&&o.onChange({originalEvent:e,value:t,stopPropagation:function(){},preventDefault:function(){},target:{name:o.name,id:o.id,value:t}})},k=function(e){return o.value.filter((function(t){return!l.equals(t,B(e),o.dataKey)}))},G=function(e){var t=B(e);return o.multiple&&o.value?o.value.some((function(e){return l.equals(e,t,o.dataKey)})):l.equals(o.value,t,o.dataKey)},V=function(e){return o.optionLabel?l.resolveFieldData(e,o.optionLabel):e&&void 0!==e.label?e.label:e},B=function(e){return o.optionValue?l.resolveFieldData(e,o.optionValue):e&&void 0!==e.value?e.value:e},M=function(e){return o.dataKey?l.resolveFieldData(e,o.dataKey):V(e)},R=function(e){return o.optionDisabled?l.isFunction(o.optionDisabled)?o.optionDisabled(e):l.resolveFieldData(e,o.optionDisabled):!(!e||void 0===e.disabled)&&e.disabled},_=function(e){return l.resolveFieldData(e,o.optionGroupLabel)},q=function(e){return l.resolveFieldData(e,o.optionGroupChildren)},z=function(t){return q(t).map((function(t,n){var r=V(t),l=n+"_"+M(t),a=R(t),i=a?null:o.tabIndex||0;return e.createElement(x,{key:l,label:r,option:t,template:o.itemTemplate,selected:G(t),onClick:P,onTouchEnd:T,tabIndex:i,disabled:a})}))},J=function(t,n){if(o.optionGroupLabel){var r=o.optionGroupTemplate?l.getJSXElement(o.optionGroupTemplate,t,n):l.resolveFieldData(t,o.optionGroupLabel),a=z(t),i=n+"_"+_(t);return e.createElement(e.Fragment,{key:i},e.createElement("li",{className:"p-listbox-item-group"},r),a)}var u=V(t),c=n+"_"+M(t),s=R(t),p=s?null:o.tabIndex||0;return e.createElement(x,{key:c,label:u,option:t,template:o.itemTemplate,selected:G(t),onClick:P,onTouchEnd:T,tabIndex:p,disabled:s})},U=function(){if(N){var e=j.trim().toLocaleLowerCase(o.filterLocale),n=o.filterBy?o.filterBy.split(","):[o.optionLabel||"label"];if(o.optionGroupLabel){var r,l=[],a=w(o.options);try{for(a.s();!(r=a.n()).done;){var i=r.value,u=t.filter(q(i),n,e,o.filterMatchMode,o.filterLocale);u&&u.length&&l.push(S(S({},i),{items:u}))}}catch(e){a.e(e)}finally{a.f()}return l}return t.filter(o.options,n,e,o.filterMatchMode,o.filterLocale)}return o.options}(),X=l.isNotEmpty(o.tooltip),$=l.findDiffKeys(o,L.defaultProps),H=r("p-listbox p-component",{"p-disabled":o.disabled},o.className),Y=r("p-listbox-list-wrapper",o.listClassName),Q=function(){if(o.virtualScrollerOptions){var t=S(S({},o.virtualScrollerOptions),{items:U,onLazyLoad:function(e){return o.virtualScrollerOptions.onLazyLoad(S(S({},e),{filter:U}))},itemTemplate:function(e,t){return e&&J(e,t.index)},contentTemplate:function(t){var n=r("p-listbox-list",t.className);return e.createElement("ul",{ref:t.contentRef,className:n,role:"listbox","aria-multiselectable":o.multiple},t.children)}});return e.createElement(a,c({ref:C},t))}var n=U?U.map(J):null;return e.createElement("ul",{className:"p-listbox-list",role:"listbox","aria-multiselectable":o.multiple},n)}(),W=o.filter?e.createElement(E,{filter:j,onFilter:A,disabled:o.disabled,filterPlaceholder:o.filterPlaceholder}):null;return e.createElement(e.Fragment,null,e.createElement("div",c({ref:O,id:o.id,className:H,style:o.style},$),W,e.createElement("div",{className:Y,style:o.listStyle},Q)),X&&e.createElement(n,c({target:O,content:o.tooltip},o.tooltipOptions)))})));L.displayName="ListBox",L.defaultProps={__TYPE:"ListBox",id:null,value:null,options:null,optionLabel:null,optionValue:null,optionDisabled:null,optionGroupLabel:null,optionGroupChildren:null,optionGroupTemplate:null,itemTemplate:null,style:null,listStyle:null,listClassName:null,className:null,virtualScrollerOptions:null,disabled:null,dataKey:null,multiple:!1,metaKeySelection:!1,filter:!1,filterBy:null,filterValue:null,filterMatchMode:"contains",filterPlaceholder:null,filterLocale:void 0,tabIndex:0,tooltip:null,tooltipOptions:null,ariaLabelledBy:null,onChange:null,onFilterValueChange:null};export{L as ListBox};
